function track = drawtrack(gui,row,scale,nRows)
%
% (C) Ann Kennedy, 2019
% California Institute of Technology
% Licensing: https://github.com/annkennedy/bento/blob/master/LICENSE.txt



track.panel = uipanel('parent',gui.ctrl.panel,...
        'position',[0.01 (row-.5)/(nRows+1) 0.98 scale/(nRows+1)],'bordertype','none');

temp{1} = uicontrol('parent',track.panel,'Style','text',...
            'String','Window (sec):','horizontalalign','right',...
            'units','normalized','Position', [0.015 0 .15 .7]);

%% Window (sec) edit 
track.win   = uicontrol('parent',track.panel,'Style','edit',...
            'String','5','Tag','winBox',...
            'units','normalized','Position', [.5 0.05 .085 .8],...
            'Callback',@updatePlot);
myaddeditfilemenu(track.win,{'drawtrack' 'updatePlot'});

%% Trace zoom
temp{2} = uicontrol('parent',track.panel,'Style','text',...
            'String','Trace zoom:','horizontalalign','right',...
            'units','normalized','Position', [.5 -.05 .115 .7]);
temp{3} = uicontrol('parent',track.panel,'Style','pushbutton',...
            'String','+',...
            'units','normalized','Position', [.5 0 .045 .8],...
            'Callback',{@changeyScale,1/1.1});
myaddeditfilemenu(temp{3},{'drawtrack' 'changeyScale'});

temp{4} = uicontrol('parent',track.panel,'Style','pushbutton',...
            'String','-',...
            'units','normalized','Position', [.5 0 .045 .8],...
            'Callback',{@changeyScale,1.1});
myaddeditfilemenu(temp{4},{'drawtrack' 'changeyScale'});


%% Plotting
temp{5} = uicontrol('parent',track.panel,'Style','text',...
            'String','Plotting:','horizontalalign','right',...
            'units','normalized','Position', [.5 0 .1 .7]);

% scaling
track.plotType.scaling = uicontrol('parent',track.panel,'Style','popupmenu',...
            'String',{'raw (scaled by trial)','raw (scaled by session)','zscored (by trial)','zscored (by session)'},'horizontalalign','right',...
            'units','normalized','Position', [.5 0 .1 .8],...
            'Callback',@changePlotType);
myaddeditfilemenu(track.plotType.scaling,{'drawtrack' 'changePlotType'});

% units of values
track.plotType.values = uicontrol('parent',track.panel,'Style','popupmenu',...
            'String',{'units','smoothed','d/dt','PCs','NMF'},...
            'units','normalized','Position', [0.5 0 .1 .8],...
            'Callback',@changePlotType);
myaddeditfilemenu(track.plotType.values,{'drawtrack' 'changePlotType'});

% display
track.plotType.display = uicontrol('parent',track.panel,'Style','popupmenu',...
            'String',{'image','lines','areas','spatial map'},'horizontalalign','right',...
            'units','normalized','Position', [.85 0 .1 .8],...
            'Callback',@changePlotType);
myaddeditfilemenu(track.plotType.display,{'drawtrack' 'changePlotType'});

% align uicontrol 
align([temp{1} track.win temp{2:5} track.plotType.scaling track.plotType.values track.plotType.display],'Fixed',5,'horizontalalignment');